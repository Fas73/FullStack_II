<!doctype html>
<html lang="es">
    <!-- Aquí comienza la cabecera del documento -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Perfil — Level‑Up Gamer</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
</head>
    <!-- Aquí comienza el cuerpo de la página -->
<body class="bg-dark text-light">
    <!-- Barra de navegación superior -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-black border-bottom border-primary sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold brand-orbitron" href="index.html">Level‑Up Gamer</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"><span class="navbar-toggler-icon"></span></button>
      <div id="mainNav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center gap-lg-2">
          <li class="nav-item"><a class="nav-link" href="catalog.html">Catálogo</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contacto</a></li>
          <li class="nav-item"><a class="nav-link position-relative" href="cart.html"><i class="bi bi-cart3"></i> Carrito <span id="navCartCount" class="badge bg-success ms-1 d-none">0</span></a></li>
          <li class="nav-item" id="navAuth"></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <h1 class="h3 brand-orbitron mb-3">Tu perfil</h1>
    <div id="profileCard" class="card card-dark p-3 mb-4"></div>
    <h2 class="h5 brand-orbitron">Historial de órdenes</h2>
    <div id="orders" class="list-group list-group-flush"></div>
  </main>

    <!-- Pie de página -->
  <footer class="py-4 small text-secondary border-top border-secondary-subtle">
    <div class="container d-flex justify-content-between"><span>© <span id="year"></span> Level‑Up Gamer</span><a class="link-secondary" href="#" id="logoutLink">Cerrar sesión</a></div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/app.js"></script>
  <script>
    App.initNavbar(); App.injectWhatsApp();
    document.getElementById('year').textContent = new Date().getFullYear();

    const user = App.getCurrentUser();
    if(!user){ location.href='login.html'; }

    function badge(level){
      const map = { Bronze:'secondary', Silver:'primary', Gold:'warning' };
      return `<span class="badge text-bg-${map[level]||'secondary'}">${level}</span>`;
    }

    const level = App.levelFromPoints(user.points||0);
    document.getElementById('profileCard').innerHTML = `
      <div class="d-flex align-items-center gap-3">
        <div class="avatar bg-primary-subtle text-primary">${(user.name||user.email).slice(0,1).toUpperCase()}</div>
        <div>
          <div class="fw-bold">${user.name||'Sin nombre'}</div>
          <div class="small text-secondary">${user.email} ${user.isDuoc?'<span class=\'badge text-bg-info ms-2\'>DUOC 20%</span>':''}</div>
          <div class="mt-2">Puntos: <strong>${user.points||0}</strong> ${badge(level)}</div>
        </div>
      </div>`;

    const orders = App.load('lup_orders', []).filter(o=>o.userEmail===user.email).reverse();
    const list = document.getElementById('orders');
    if(orders.length===0){ list.innerHTML = '<div class="text-secondary">Aún no tienes órdenes.</div>'; }
    else{
      orders.forEach(o=>{
        const a = document.createElement('div');
        a.className = 'list-group-item bg-transparent text-light border-secondary-subtle';
        a.innerHTML = `<div class="d-flex justify-content-between"><div>
          <div class="fw-semibold">Orden #${o.id}</div>
          <div class="small text-secondary">${new Date(o.date).toLocaleString()}</div>
        </div>
        <div class="text-end">
          <div>Total: <strong>${App.formatCLP(o.total)}</strong></div>
          <div class="small text-secondary">Pts usados: ${o.pointsUsed} • Pts ganados: ${o.pointsEarned}</div>
        </div></div>`;
        list.appendChild(a);
      });
    }
  </script>
</body>
</html>